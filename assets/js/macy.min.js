!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.Macy=n()}(this,function(){"use strict";function s(t,n,e){!function(t,n,e){Promise.all(function(i,t){var s=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return function(t){for(var n,e=t.length,o=e,r=[];e--;)r.push((n=t[o-e-1],function(n,e,t){var o=2<arguments.length&&void 0!==t&&t;return new Promise(function(t,n){if(e.complete)return(d(e)?t:n)(e);e.addEventListener("load",function(){return(d(e)?t:n)(e)}),e.addEventListener("error",function(){return n(e)})}).then(function(t){o&&n.emit(n.constants.EVENT_IMAGE_LOAD,{img:t})}).catch(function(t){return n.emit(n.constants.EVENT_IMAGE_ERROR,{img:t})})}(i,n,s)));return r}(t)}(t,n,2<arguments.length&&void 0!==e&&e)).then(function(){t.emit(t.constants.EVENT_IMAGE_COMPLETE)})}(t,n,2<arguments.length&&void 0!==e&&e)}function n(t){var n,e=document.body.clientWidth,o={columns:t.columns};v(t.margin)?o.margin={x:t.margin.x,y:t.margin.y}:o.margin={x:t.margin,y:t.margin};for(var r=Object.keys(t.breakAt),i=r.length-1;0<=i;i--){var s=parseInt(r[i],10);e<=s&&(n=t.breakAt[s],v(n)||(o.columns=n),v(n)&&n.columns&&(o.columns=n.columns),v(n)&&n.margin&&!v(n.margin)&&(o.margin={x:n.margin,y:n.margin}),v(n)&&n.margin&&v(n.margin)&&n.margin.x&&(o.margin.x=n.margin.x),v(n)&&n.margin&&v(n.margin)&&n.margin.y&&(o.margin.y=n.margin.y))}return o}function l(t){return n(t).columns}function h(t){return n(t).margin}function p(t,n){var e=!(1<arguments.length&&void 0!==n)||n,o=l(t),n=h(t).x,t=100/o;return e?1===o?"100%":"calc("+t+"% - "+(n=(o-1)*n/o)+"px)":t}function a(t){var n=0,e=t.container;m(t.rows,function(t){n=n<t?t:n}),e.style.height=n+"px"}function c(t,n){if(!(this instanceof c))return new c(t,n);if(t=t.replace(/^\s*/,"").replace(/\s*$/,""),n)return this.byCss(t,n);for(var e in this.selectors)if(n=e.split("/"),new RegExp(n[1],n[2]).test(t))return this.selectors[e](t);return this.byCss(t)}function u(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.running=!1,this.events=[],this.add(t)}c.prototype.byCss=function(t,n){return(n||document).querySelectorAll(t)},(c.prototype.selectors={})[/^\.[\w\-]+$/]=function(t){return document.getElementsByClassName(t.substring(1))},c.prototype.selectors[/^\w+$/]=function(t){return document.getElementsByTagName(t)},c.prototype.selectors[/^\#[\w\-]+$/]=function(t){return document.getElementById(t.substring(1))};var m=function(t,n){for(var e=t.length,o=e;e--;)n(t[o-e-1])};function o(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.instance=t,this.data=n,this}function f(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.events={},this.instance=t}function d(t){return!("naturalHeight"in t&&t.naturalHeight+t.naturalWidth===0)||t.width+t.height!==0}function e(t){var n,e,o,r,i;(i=t).container=c(i.options.container),i.container instanceof c||!i.container?i.options.debug&&console.error("Error: Container not found"):(delete i.options.container,i.container.length&&(i.container=i.container[0]),i.container.style.position="relative"),(i=t).queue=new u,i.events=new f(i),i.rows=[],i.resizer=(e=i,o=function(){e.emit(e.constants.EVENT_RESIZE),e.queue.add(function(){return e.recalculate(!0,!0)})},r=void 0,function(){r&&clearTimeout(r),r=setTimeout(o,100)}),t=c("img",(n=t).container),window.addEventListener("resize",n.resizer),n.on(n.constants.EVENT_IMAGE_LOAD,function(){return n.recalculate(!1,!1)}),n.on(n.constants.EVENT_IMAGE_COMPLETE,function(){return n.recalculate(!0,!0)}),n.options.useOwnImageLoader||s(n,t,!n.options.waitForImages),n.emit(n.constants.EVENT_INITIALIZED)}function g(t,n,e){var o,r,i,s,a,c,e=2<arguments.length&&void 0!==e&&e;if(t.lastcol||(t.lastcol=0),e=t.rows.length<1?!0:e){t.rows=[],t.cols=[],t.lastcol=0;for(var u=n-1;0<=u;u--)t.rows[u]=0,t.cols[u]=(r=u,0,i=l((o=t).options),s=0,1==++r?0:(a=((c=h(o.options).x)-(i-1)*c/i)*(r-1),"calc("+(s+=p(o.options,!1)*(r-1))+"% + "+a+"px)"))}else if(t.tmpRows)for(t.rows=[],u=n-1;0<=u;u--)t.rows[u]=t.tmpRows[u];else for(t.tmpRows=[],u=n-1;0<=u;u--)t.tmpRows[u]=t.rows[u]}function r(t,n,e){var o=1<arguments.length&&void 0!==n&&n,n=!(2<arguments.length&&void 0!==e)||e,e=o?t.container.children:c(':scope > *:not([data-macy-complete="1"])',t.container),r=p(t.options);return m(e,function(t){o&&(t.dataset.macyComplete=0),t.style.width=r}),(t.options.trueOrder?function(e,t,n,o){var n=2<arguments.length&&void 0!==n&&n,r=!(3<arguments.length&&void 0!==o)||o,i=l(e.options),s=h(e.options).y;g(e,i,n),m(t,function(t){e.lastcol===i&&(e.lastcol=0);window.getComputedStyle(t,null).getPropertyValue("height");var n=parseInt(t.offsetHeight,10);isNaN(n)||(t.style.position="absolute",t.style.top=e.rows[e.lastcol]+"px",t.style.left=""+e.cols[e.lastcol],e.rows[e.lastcol]+=isNaN(n)?0:n+s,e.lastcol+=1,r&&(t.dataset.macyComplete=1))}),r&&(e.tmpRows=null),a(e)}:function(o,t,n,e){var n=2<arguments.length&&void 0!==n&&n,r=!(3<arguments.length&&void 0!==e)||e,e=l(o.options),i=h(o.options).y;g(o,e,n),m(t,function(t){var e=0,n=parseInt(t.offsetHeight,10);isNaN(n)||(o.rows.forEach(function(t,n){t<o.rows[e]&&(e=n)}),t.style.position="absolute",t.style.top=o.rows[e]+"px",t.style.left=""+o.cols[e],o.rows[e]+=isNaN(n)?0:n+i,r&&(t.dataset.macyComplete=1))}),r&&(o.tmpRows=null),a(o)})(t,e,o,n),t.emit(t.constants.EVENT_RECALCULATED)}u.prototype.run=function(){var t;!this.running&&0<this.events.length&&(t=this.events.shift(),this.running=!0,t(),this.running=!1,this.run())},u.prototype.add=function(){var n=this,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return!!t&&(Array.isArray(t)?m(t,function(t){return n.add(t)}):(this.events.push(t),void this.run()))},u.prototype.clear=function(){this.events=[]},f.prototype.on=function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return!(!t||!n)&&(Array.isArray(this.events[t])||(this.events[t]=[]),this.events[t].push(n))},f.prototype.emit=function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!t||!Array.isArray(this.events[t]))return!1;var e=new o(this.instance,n);m(this.events[t],function(t){return t(e)})};var v=function(t){return t===Object(t)&&"[object Array]"!==Object.prototype.toString.call(t)},i=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e,o=arguments[n];for(e in o)Object.prototype.hasOwnProperty.call(o,e)&&(t[e]=o[e])}return t},y={columns:4,margin:2,trueOrder:!1,waitForImages:!1,useImageLoader:!0,breakAt:{},useOwnImageLoader:!1,onInit:!1};function E(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:y;if(!(this instanceof E))return new E(t);this.options={},i(this.options,y,t),e(this)}return function(){try{document.createElement("a").querySelector(":scope *")}catch(t){!function(){function t(e){return function(t){if(t&&o.test(t)){var n=this.getAttribute("id");n||(this.id="q"+Math.floor(9e6*Math.random())+1e6),arguments[0]=t.replace(o,"#"+this.id);t=e.apply(this,arguments);return null===n?this.removeAttribute("id"):n||(this.id=n),t}return e.apply(this,arguments)}}var o=/:scope\b/gi,n=t(Element.prototype.querySelector);Element.prototype.querySelector=function(t){return n.apply(this,arguments)};var e=t(Element.prototype.querySelectorAll);Element.prototype.querySelectorAll=function(t){return e.apply(this,arguments)}}()}}(),E.init=function(t){return console.warn("Depreciated: Macy.init will be removed in v3.0.0 opt to use Macy directly like so Macy({ /*options here*/ }) "),new E(t)},E.prototype.recalculateOnImageLoad=function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return s(this,c("img",this.container),!t)},E.prototype.runOnImageLoad=function(t){var n=1<arguments.length&&void 0!==arguments[1]&&arguments[1],e=c("img",this.container);return this.on(this.constants.EVENT_IMAGE_COMPLETE,t),n&&this.on(this.constants.EVENT_IMAGE_LOAD,t),s(this,e,n)},E.prototype.recalculate=function(){var t=this,n=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return e&&this.queue.clear(),this.queue.add(function(){return r(t,n,e)})},E.prototype.remove=function(){window.removeEventListener("resize",this.resizer),m(this.container.children,function(t){t.removeAttribute("data-macy-complete"),t.removeAttribute("style")}),this.container.removeAttribute("style")},E.prototype.reInit=function(){this.recalculate(!0,!0),this.emit(this.constants.EVENT_INITIALIZED),window.addEventListener("resize",this.resizer),this.container.style.position="relative"},E.prototype.on=function(t,n){this.events.on(t,n)},E.prototype.emit=function(t,n){this.events.emit(t,n)},E.prototype.constants=E.constants={EVENT_INITIALIZED:"macy.initialized",EVENT_RECALCULATED:"macy.recalculated",EVENT_IMAGE_LOAD:"macy.image.load",EVENT_IMAGE_ERROR:"macy.image.error",EVENT_IMAGE_COMPLETE:"macy.images.complete",EVENT_RESIZE:"macy.resize"},E});